<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="google-adsense-account" content="ca-pub-9445493979241456">
  <title>üè∏ Badminton Bot - Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 16px;
      padding-top: max(16px, env(safe-area-inset-top));
      padding-bottom: max(16px, env(safe-area-inset-bottom));
      padding-left: max(16px, env(safe-area-inset-left));
      padding-right: max(16px, env(safe-area-inset-right));
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
      margin-bottom: 40px;
      flex-wrap: wrap;
      gap: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="10" cy="60" r="0.5" fill="white" opacity="0.1"/><circle cx="90" cy="40" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      opacity: 0.3;
    }

    .header > div {
      position: relative;
      z-index: 1;
    }

    .header > div {
      text-align: center;
      flex: 1;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .header p {
      opacity: 0.9;
      font-size: 1.1em;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    /* Login Modal */
    .login-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      backdrop-filter: blur(8px);
      overflow-y: auto;
    }

    body.modal-open {
      overflow: hidden;
    }

    .login-modal-content {
      background: white;
      margin: 10vh auto;
      padding: 40px;
      border-radius: 20px;
      width: 90%;
      max-width: 420px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.4);
      position: relative;
      animation: modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      transform: translateY(0);
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-80px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .close {
      position: absolute;
      right: 20px;
      top: 20px;
      font-size: 28px;
      font-weight: bold;
      color: #aaa;
      cursor: pointer;
      transition: color 0.3s;
    }

    .close:hover {
      color: #000;
    }

    .login-form h2 {
      color: #667eea;
      margin-bottom: 10px;
      text-align: center;
      font-size: 1.8em;
    }

    .login-form p {
      color: #666;
      text-align: center;
      margin-bottom: 30px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .form-group input:focus {
      outline: none;
      border-color: #667eea;
    }

    .login-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 15px;
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }

    .login-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .error-message {
      background: #f8d7da;
      color: #721c24;
      padding: 12px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
      display: none;
    }

    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 12px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
      display: none;
    }

    .loading {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      z-index: 10;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .loading-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      position: relative;
    }

    .loading-spinner::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      background: #667eea;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      animation: pulse 1.5s ease-in-out infinite;
    }

    .loading-text {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      margin: 0;
    }

    .loading-subtext {
      font-size: 14px;
      color: #666;
      margin: 0;
      opacity: 0.8;
    }

    .loading-dots {
      display: flex;
      gap: 4px;
      margin-top: 10px;
    }

    .loading-dot {
      width: 8px;
      height: 8px;
      background: #667eea;
      border-radius: 50%;
      animation: bounce 1.4s ease-in-out infinite both;
    }

    .loading-dot:nth-child(1) { animation-delay: -0.32s; }
    .loading-dot:nth-child(2) { animation-delay: -0.16s; }
    .loading-dot:nth-child(3) { animation-delay: 0s; }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 0.5; transform: translate(-50%, -50%) scale(0.8); }
    }

    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }

    .loading-success {
      color: #28a745;
    }

    .loading-success .loading-spinner {
      border-top-color: #28a745;
    }

    .loading-success .loading-spinner::after {
      background: #28a745;
    }

    .loading-error {
      color: #dc3545;
    }

    .loading-error .loading-spinner {
      border-top-color: #dc3545;
      animation: shake 0.5s ease-in-out;
    }

    .loading-error .loading-spinner::after {
      background: #dc3545;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    .demo-credentials {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      font-size: 14px;
    }

    .demo-credentials h3 {
      color: #333;
      margin-bottom: 10px;
    }

    .demo-credentials p {
      margin: 5px 0;
      color: #666;
    }

    /* Mobile responsive for modal */
    @media (max-width: 768px) {
      .login-modal-content {
        margin: 5vh auto;
        padding: 30px 20px;
        width: 95%;
        max-width: 350px;
      }
      
      .login-form h2 {
        font-size: 1.5em;
      }
      
      .form-group input {
        font-size: 16px; /* Prevent zoom on iOS */
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
      }

      .loading-spinner::after {
        width: 16px;
        height: 16px;
      }

      .loading-text {
        font-size: 16px;
      }

      .loading-subtext {
        font-size: 13px;
      }
    }

    @media (max-width: 480px) {
      .login-modal-content {
        margin: 2vh auto;
        padding: 25px 15px;
        width: 98%;
        max-width: 320px;
      }
      
      .login-form h2 {
        font-size: 1.3em;
      }
      
      .demo-credentials {
        padding: 12px;
        font-size: 13px;
      }

      .loading-spinner {
        width: 45px;
        height: 45px;
      }

      .loading-spinner::after {
        width: 14px;
        height: 14px;
      }

      .loading-text {
        font-size: 15px;
      }

      .loading-subtext {
        font-size: 12px;
      }

      .loading-dot {
        width: 6px;
        height: 6px;
      }
    }

    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    }

    .stat-card h3 {
      color: #667eea;
      font-size: 0.9em;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    .stat-card .value {
      font-size: 2.5em;
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
    }

    .stat-card .label {
      color: #666;
      font-size: 0.95em;
    }

    .sessions-container {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    .sessions-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .sessions-header h2 {
      color: #333;
      font-size: 1.8em;
    }

    .filter-buttons {
      display: flex;
      gap: 10px;
    }

    .filter-btn {
      padding: 10px 20px;
      border: 2px solid #667eea;
      background: white;
      color: #667eea;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .filter-btn:hover, .filter-btn.active {
      background: #667eea;
      color: white;
    }

    .session-card {
      background: white;
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 20px;
      border-left: 5px solid #667eea;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      position: relative;
      overflow: hidden;
    }

    .session-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea, #764ba2);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .session-card:hover {
      background: #f8f9fa;
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 12px 30px rgba(102, 126, 234, 0.15);
      border-left-color: #764ba2;
    }

    .session-card:hover::before {
      transform: scaleX(1);
    }

    .session-card.completed {
      border-left-color: #28a745;
    }

    .session-card.pending {
      border-left-color: #ffc107;
    }

    .session-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .session-date {
      font-size: 1.3em;
      font-weight: bold;
      color: #333;
    }

    .session-status {
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.85em;
      text-transform: uppercase;
    }

    .session-status.completed {
      background: #d4edda;
      color: #155724;
    }

    .session-status.pending {
      background: #fff3cd;
      color: #856404;
    }

    .session-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .session-stat {
      background: white;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
    }

    .session-stat-value {
      font-size: 1.5em;
      font-weight: bold;
      color: #667eea;
    }

    .session-stat-label {
      font-size: 0.85em;
      color: #666;
      margin-top: 5px;
    }

    .loading {
      text-align: center;
      padding: 50px;
      color: white;
      font-size: 1.2em;
      position: relative;
    }

    .loading::before {
      content: '';
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid rgba(255,255,255,0.3);
      border-top: 3px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 12px;
      vertical-align: middle;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .fade-in {
      animation: fadeIn 0.6s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .slide-in {
      animation: slideIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .error {
      background: #f8d7da;
      color: #721c24;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      border-left: 5px solid #dc3545;
    }

    .refresh-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      background: white;
      border: none;
      border-radius: 50%;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      cursor: pointer;
      font-size: 1.5em;
      transition: all 0.3s ease;
    }

    .refresh-btn:hover {
      transform: scale(1.1) rotate(180deg);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }

    .top-participants {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    .master-statistics {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    .master-stats-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .master-stats-header h2 {
      color: #333;
      margin: 0;
      font-size: 1.8em;
    }

    .master-stats-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .master-stats-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .master-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .master-stat-card {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 2px solid transparent;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .master-stat-card:hover {
      border-color: #667eea;
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .master-stat-icon {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .master-stat-value {
      font-size: 2em;
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
    }

    .master-stat-label {
      color: #666;
      font-size: 0.9em;
      font-weight: 500;
    }

    .master-stat-trend {
      font-size: 0.8em;
      margin-top: 5px;
      font-weight: 600;
    }

    .trend-up {
      color: #28a745;
    }

    .trend-down {
      color: #dc3545;
    }

    .trend-neutral {
      color: #6c757d;
    }

    /* Master Statistics Modal */
    .master-stats-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    .master-stats-modal-content {
      background-color: #fefefe;
      margin: 2% auto;
      padding: 0;
      border-radius: 15px;
      width: 95%;
      max-width: 1000px;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .master-stats-modal-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .master-stats-modal-header h2 {
      font-size: 24px;
      font-weight: 600;
      margin: 0;
    }

    .master-stats-close {
      color: white;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: opacity 0.3s;
    }

    .master-stats-close:hover {
      opacity: 0.7;
    }

    .master-stats-modal-body {
      padding: 30px;
      max-height: calc(90vh - 120px);
      overflow-y: auto;
    }

    .detailed-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
    }

    .detailed-stat-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 25px;
      border: 2px solid #e9ecef;
    }

    .detailed-stat-section h3 {
      color: #333;
      margin-bottom: 20px;
      font-size: 1.3em;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    .detailed-stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #dee2e6;
    }

    .detailed-stat-item:last-child {
      border-bottom: none;
    }

    .stat-label {
      font-weight: 500;
      color: #495057;
    }

    .stat-value {
      font-weight: bold;
      color: #333;
      font-size: 1.1em;
    }

    .user-payments-container {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .user-payments-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .user-payments-header h2 {
      color: #333;
      font-size: 1.8em;
    }

    .user-payment-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      border-left: 5px solid #667eea;
      transition: all 0.3s ease;
    }

    .user-payment-card:hover {
      background: #e9ecef;
      transform: translateX(5px);
    }

    .user-payment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5em;
      font-weight: bold;
    }

    .user-details h3 {
      margin: 0;
      color: #333;
      font-size: 1.2em;
    }

    .user-details p {
      margin: 5px 0 0 0;
      color: #666;
      font-size: 0.9em;
    }

    .payment-summary {
      text-align: right;
    }

    .total-amount {
      font-size: 1.5em;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 5px;
    }

    .payment-count {
      color: #666;
      font-size: 0.9em;
    }

    .payment-timeline {
      margin-top: 15px;
    }

    .timeline-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .timeline-header h4 {
      margin: 0;
      color: #333;
      font-size: 1em;
    }

    .timeline-toggle {
      background: #667eea;
      color: white;
      border: none;
      padding: 5px 15px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.8em;
      transition: all 0.3s ease;
    }

    .timeline-toggle:hover {
      background: #5a6fd8;
    }

    .timeline-content {
      display: none;
      margin-top: 15px;
    }

    .timeline-content.show {
      display: block;
    }

    .timeline-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background: white;
      border-radius: 8px;
      margin-bottom: 8px;
      border: 1px solid #e9ecef;
      transition: all 0.3s ease;
    }

    .timeline-item:hover {
      border-color: #667eea;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
    }

    .timeline-date {
      color: #666;
      font-size: 0.9em;
    }

    .timeline-amount {
      font-weight: bold;
      color: #333;
    }

    .timeline-status {
      padding: 3px 10px;
      border-radius: 15px;
      font-size: 0.8em;
      font-weight: 600;
      text-transform: uppercase;
    }

    .timeline-status.paid {
      background: #d4edda;
      color: #155724;
    }

    .timeline-status.unpaid {
      background: #f8d7da;
      color: #721c24;
    }

    .no-payments {
      text-align: center;
      padding: 40px;
      color: #666;
      font-style: italic;
    }

    .top-participants h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 1.8em;
    }

    .participant-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 10px;
      transition: background 0.3s ease;
    }

    .participant-item:hover {
      background: #e9ecef;
    }

    .participant-rank {
      width: 30px;
      height: 30px;
      background: #667eea;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .participant-name {
      flex: 1;
      margin-left: 15px;
      font-weight: 600;
      color: #333;
    }

    .participant-count {
      background: #667eea;
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: 600;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      backdrop-filter: blur(5px);
      animation: fadeIn 0.3s ease;
    }

    .modal-content {
      background: white;
      margin: 5% auto;
      padding: 0;
      border-radius: 20px;
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: slideIn 0.3s ease;
      position: relative;
    }

    .modal-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px 30px;
      border-radius: 20px 20px 0 0;
      position: relative;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 1.8em;
      font-weight: 600;
    }

    .modal-header .close {
      position: absolute;
      right: 25px;
      top: 25px;
      font-size: 2em;
      font-weight: bold;
      cursor: pointer;
      opacity: 0.8;
      transition: opacity 0.3s ease;
    }

    .modal-header .close:hover {
      opacity: 1;
    }

    .modal-body {
      padding: 30px;
    }

    .session-detail-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .detail-card {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      border-left: 4px solid #667eea;
    }

    .detail-card h3 {
      color: #667eea;
      font-size: 0.9em;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    .detail-card .value {
      font-size: 2em;
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
    }

    .detail-card .label {
      color: #666;
      font-size: 0.9em;
    }

    .participants-section {
      margin-top: 30px;
    }

    .participants-section h3 {
      color: #333;
      margin-bottom: 20px;
      font-size: 1.3em;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    .participant-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
    }

    .participant-card {
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 10px;
      padding: 15px;
      transition: all 0.3s ease;
    }

    .participant-card:hover {
      border-color: #667eea;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
    }

    .participant-name {
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }

    .participant-gender {
      font-size: 0.9em;
      color: #666;
    }

    .payments-section {
      margin-top: 30px;
    }

    .payment-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
      margin-bottom: 10px;
      transition: background 0.3s ease;
    }

    .payment-item:hover {
      background: #e9ecef;
    }

    .payment-name {
      font-weight: 600;
      color: #333;
    }

    .payment-amount {
      font-weight: bold;
      color: #667eea;
    }

    .payment-status {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: 600;
      text-transform: uppercase;
    }

    .payment-status.paid {
      background: #d4edda;
      color: #155724;
    }

    .payment-status.unpaid {
      background: #f8d7da;
      color: #721c24;
    }

    .stats-summary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 30px;
    }

    .stats-summary h3 {
      margin: 0 0 15px 0;
      font-size: 1.3em;
    }

    .stats-summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
    }

    .summary-item {
      text-align: center;
    }

    .summary-value {
      font-size: 1.8em;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .summary-label {
      font-size: 0.9em;
      opacity: 0.9;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideIn {
      from { 
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to { 
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.8em;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .session-stats {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .modal-content {
        width: 95%;
        margin: 10% auto;
        border-radius: 20px;
      }

      .modal-body {
        padding: 25px;
      }

      .session-detail-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .participant-list {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .master-stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .master-stat-card {
        padding: 20px 15px;
      }

      .master-stat-icon {
        font-size: 2rem;
      }

      .master-stat-value {
        font-size: 1.5rem;
      }

      .master-stat-label {
        font-size: 0.8rem;
      }
    }

    /* iPhone specific optimizations */
    @media (max-width: 428px) {
      body {
        padding: 12px;
      }
      
      .container {
        padding: 0;
      }
      
      .header {
        flex-direction: column;
        gap: 8px;
        text-align: center;
        margin-bottom: 16px;
      }
      
      .header h1 {
        font-size: 1.375rem;
        font-weight: 700;
        margin: 0;
        line-height: 1.3;
      }
      
      .header p {
        font-size: 0.8125rem;
        opacity: 0.9;
        margin: 0;
        line-height: 1.4;
      }
      
      .refresh-btn {
        padding: 8px 16px;
        font-size: 0.8125rem;
        align-self: center;
        font-weight: 500;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        margin-bottom: 16px;
      }
      
      .stat-card {
        padding: 12px;
        border-radius: 12px;
      }
      
      .stat-card h3 {
        font-size: 0.6875rem;
        font-weight: 500;
        margin-bottom: 6px;
        opacity: 0.9;
      }
      
      .stat-card .value {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 2px;
        line-height: 1.2;
      }
      
      .stat-card .label {
        font-size: 0.6875rem;
        opacity: 0.85;
      }
      
      .sessions-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .session-card {
        border-radius: 16px;
      }
      
      .session-header {
        padding: 12px;
      }
      
      .session-date {
        font-size: 0.875rem;
        font-weight: 500;
        line-height: 1.4;
      }
      
      .session-status {
        padding: 4px 10px;
        font-size: 0.6875rem;
        font-weight: 500;
      }
      
      .session-body {
        padding: 12px;
      }
      
      .session-stats {
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
      }
      
      .session-stat {
        padding: 8px;
        border-radius: 8px;
      }
      
      .session-stat h4 {
        font-size: 0.625rem;
        font-weight: 500;
        margin-bottom: 4px;
        opacity: 0.9;
      }
      
      .session-stat .value {
        font-size: 1.0625rem;
        font-weight: 600;
        line-height: 1.2;
      }
      
      .session-actions {
        flex-direction: row;
        gap: 6px;
        flex-wrap: wrap;
      }
      
      .btn {
        padding: 6px 12px;
        font-size: 0.75rem;
        font-weight: 500;
        border-radius: 16px;
        flex: 1;
        min-width: 80px;
      }
      
      .user-payments-container {
        margin-top: 16px;
      }
      
      .user-payments-header h2 {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 12px;
        line-height: 1.4;
      }
      
      .filter-buttons {
        flex-wrap: wrap;
        gap: 6px;
      }
      
      .filter-btn {
        padding: 6px 12px;
        font-size: 0.75rem;
        font-weight: 500;
        border-radius: 16px;
      }
      
      .user-card {
        padding: 12px;
        border-radius: 12px;
        margin-bottom: 8px;
      }
      
      .user-header {
        gap: 12px;
        margin-bottom: 8px;
      }
      
      .user-avatar {
        width: 36px;
        height: 36px;
        font-size: 0.875rem;
        font-weight: 600;
        flex-shrink: 0;
      }
      
      .user-info h3 {
        font-size: 0.9375rem;
        font-weight: 500;
        margin: 0;
        line-height: 1.4;
      }
      
      .user-info p {
        font-size: 0.75rem;
        margin: 2px 0 0 0;
        opacity: 0.85;
        line-height: 1.3;
      }
      
      .user-summary {
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
        margin-bottom: 8px;
      }
      
      .summary-item {
        padding: 8px;
        border-radius: 8px;
      }
      
      .summary-value {
        font-size: 1.0625rem;
        font-weight: 600;
        margin-bottom: 2px;
        line-height: 1.2;
      }
      
      .summary-label {
        font-size: 0.625rem;
        opacity: 0.85;
      }
      
      .payment-timeline {
        padding: 8px;
        border-radius: 8px;
      }
      
      .timeline-item {
        padding: 8px 10px;
        margin-bottom: 4px;
        border-radius: 6px;
      }
      
      .timeline-date {
        font-size: 0.625rem;
        opacity: 0.85;
      }
      
      .timeline-amount {
        font-size: 0.8125rem;
        font-weight: 500;
      }
      
      .timeline-status {
        padding: 2px 6px;
        font-size: 0.625rem;
        font-weight: 500;
      }
    }

    /* iPhone 11 Pro Max and larger (414px+) */
    @media (min-width: 414px) and (max-width: 428px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
      
      .session-stats {
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
      }
    }

    /* iPhone 12 Pro Max and larger (428px+) */
    @media (min-width: 428px) and (max-width: 480px) {
      .stats-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
      }
      
      .session-stats {
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
      }
    }

    /* iPhone 14 Pro Max and larger (430px+) */
    @media (min-width: 430px) and (max-width: 600px) {
      .stats-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
      }
      
      .session-stats {
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
      }
    }

    /* Landscape orientation for phones */
    @media (max-height: 500px) and (orientation: landscape) {
      .header {
        flex-direction: row;
        margin-bottom: 15px;
      }
      
      .stats-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
      }
      
      .sessions-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
  <div class="header">
    <div>
      <h1>üè∏ Badmintonight M·ªπ ƒê√¨nh</h1>
      <p>Qu·∫£n l√Ω sessions v√† th·ªëng k√™ vote</p>
    </div>
    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
      <button onclick="openLoginModal()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 24px; border-radius: 25px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; display: inline-block; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); border: none; cursor: pointer;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'">üîê Admin Panel</button>
      <a href="/api-docs" target="_blank" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 12px 24px; border-radius: 25px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; display: inline-block; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(40, 167, 69, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(40, 167, 69, 0.3)'">üìö API Docs</a>
    </div>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" class="login-modal">
    <div class="login-modal-content">
      <span class="close" onclick="closeLoginModal()">&times;</span>
      <div class="login-form">
        <h2>üîê ƒêƒÉng Nh·∫≠p</h2>
        <p>Badminton Bot - Admin Panel</p>
        
        <div id="login-loading" class="loading" style="display: none;">
          <div class="loading-content">
            <div class="loading-spinner"></div>
            <div>
              <p class="loading-text">ƒêang x√°c th·ª±c</p>
              <p class="loading-subtext">Vui l√≤ng ch·ªù trong gi√¢y l√°t...</p>
              <div class="loading-dots">
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
              </div>
            </div>
          </div>
        </div>
        
        <form onsubmit="handleLogin(event)">
          <div class="form-group">
            <label for="login-username">T√™n ƒëƒÉng nh·∫≠p</label>
            <input type="text" id="login-username" placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p" required>
          </div>
          
          <div class="form-group">
            <label for="login-password">M·∫≠t kh·∫©u</label>
            <input type="password" id="login-password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required>
          </div>
          
          <button type="submit" class="login-btn" id="login-submit-btn">üöÄ ƒêƒÉng Nh·∫≠p</button>
        </form>

        <div class="demo-credentials">
          <h3>üìã Th√¥ng tin ƒëƒÉng nh·∫≠p demo:</h3>
          <p><strong>Username:</strong> admin</p>
          <p><strong>Password:</strong> 12345</p>
        </div>
      </div>
    </div>
  </div>

    <div id="overview-stats" class="stats-grid">
      <!-- Stats cards will be inserted here -->
    </div>

    <!-- Active Sessions -->
    <div class="sessions-container">
      <div class="sessions-header">
        <h2>üéØ Sessions ƒêang Ho·∫°t ƒê·ªông</h2>
      </div>
      <div id="active-sessions-list">
        <div class="loading">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</div>
      </div>
    </div>

    <!-- History Sessions -->
    <div class="sessions-container" style="margin-top: 30px;">
      <div class="sessions-header">
        <h2>üìö L·ªãch S·ª≠ Sessions</h2>
        <div class="filter-buttons">
          <button class="filter-btn active" onclick="filterHistory('all')" title="Hi·ªÉn th·ªã t·∫•t c·∫£ sessions ƒë√£ ho√†n th√†nh">T·∫•t c·∫£</button>
          <button class="filter-btn" onclick="filterHistory('recent')" title="Ch·ªâ hi·ªÉn th·ªã 10 sessions g·∫ßn ƒë√¢y nh·∫•t">G·∫ßn ƒë√¢y</button>
        </div>
      </div>
      <div id="history-sessions-list">
        <div class="loading">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</div>
      </div>
    </div>

    <div class="top-participants">
      <h2>üèÜ Top Ng∆∞·ªùi Tham Gia (30 ng√†y qua)</h2>
      <div id="top-participants-list">
        <div class="loading">‚è≥ ƒêang t·∫£i...</div>
      </div>
    </div>

    <div class="master-statistics">
      <div class="master-stats-header">
        <h2>üìä Th·ªëng K√™ T·ªïng Quan</h2>
        <button class="master-stats-btn" onclick="openMasterStatistics()">üìà Xem Chi Ti·∫øt</button>
      </div>
      <div class="master-stats-grid" id="master-stats-grid">
        <div class="loading">‚è≥ ƒêang t·∫£i...</div>
      </div>
    </div>

    <div class="user-payments-container">
      <div class="user-payments-header">
        <h2>üí∞ Th·ªëng K√™ Thanh To√°n Theo User</h2>
        <div class="filter-buttons">
          <button class="filter-btn active" onclick="filterUserPayments('all')">T·∫•t c·∫£</button>
          <button class="filter-btn" onclick="filterUserPayments('paid')">ƒê√£ tr·∫£</button>
          <button class="filter-btn" onclick="filterUserPayments('unpaid')">Ch∆∞a tr·∫£</button>
        </div>
      </div>
      <div id="user-payments-list">
        <div class="loading">‚è≥ ƒêang t·∫£i...</div>
      </div>
    </div>
  </div>

  <button class="refresh-btn" onclick="loadAllData()" title="L√†m m·ªõi d·ªØ li·ªáu">üîÑ</button>

  <!-- Modal removed - using separate page instead -->

  <script src="/js/auth.js"></script>
  <script>
    // Wait for auth.js to load
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, authManager available:', typeof window.authManager);
      
      // Debug authentication status
      if (window.authManager) {
        console.log('Auth token exists:', !!window.authManager.token);
        console.log('User info:', window.authManager.userInfo);
        console.log('Is logged in:', window.authManager.isLoggedIn());
      }
    });

    // Login Modal Functions
    function openLoginModal() {
      console.log('Opening login modal');
      console.log('authManager available:', typeof window.authManager);
      
      // Refresh authentication status before checking
      if (window.authManager) {
        window.authManager.refreshAuthStatus();
      }
      
      // Check if user is already logged in
      if (window.authManager && window.authManager.isLoggedIn()) {
        console.log('User already authenticated, redirecting to admin panel');
        // Add a small delay to ensure the redirect works properly
        setTimeout(() => {
          window.location.href = '/admin.html';
        }, 100);
        return;
      }
      
      // Prevent background scroll
      document.body.classList.add('modal-open');
      
      document.getElementById('loginModal').style.display = 'block';
      // Auto-fill demo credentials
      document.getElementById('login-username').value = 'admin';
      document.getElementById('login-password').value = '12345';
      
      // Focus on username field
      setTimeout(() => {
        document.getElementById('login-username').focus();
      }, 100);
    }

    function closeLoginModal() {
      // Re-enable background scroll
      document.body.classList.remove('modal-open');
      
      document.getElementById('loginModal').style.display = 'none';
      // Clear form
      document.getElementById('login-username').value = '';
      document.getElementById('login-password').value = '';
      // Hide loading and show form
      document.getElementById('login-loading').style.display = 'none';
      document.querySelector('.login-form form').style.display = 'block';
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('loginModal');
      if (event.target == modal) {
        closeLoginModal();
      }
    }

    // Close modal with Escape key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const modal = document.getElementById('loginModal');
        if (modal.style.display === 'block') {
          closeLoginModal();
        }
      }
    });

    // Handle login form submission
    async function handleLogin(event) {
      event.preventDefault();
      console.log('Login form submitted');
      
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;
      console.log('Username:', username, 'Password:', password);
      
      const loading = document.getElementById('login-loading');
      const loginBtn = document.getElementById('login-submit-btn');
      const form = document.querySelector('.login-form form');

      // Show loading and hide form
      loading.style.display = 'block';
      form.style.display = 'none';
      loginBtn.disabled = true;

      try {
        console.log('Calling login API directly...');
        
        const response = await fetch('/api/v1/auth/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ username, password })
        });
        
        const result = await response.json();
        console.log('Login result:', result);
        
        if (result.success) {
          // Store token and user info
          localStorage.setItem('authToken', result.data.token);
          localStorage.setItem('userInfo', JSON.stringify(result.data.user));
          
          // Update loading to success state
          loading.className = 'loading loading-success';
          loading.innerHTML = `
            <div class="loading-content">
              <div class="loading-spinner"></div>
              <div>
                <p class="loading-text">‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!</p>
                <p class="loading-subtext">ƒêang chuy·ªÉn h∆∞·ªõng ƒë·∫øn Admin Panel...</p>
                <div class="loading-dots">
                  <div class="loading-dot"></div>
                  <div class="loading-dot"></div>
                  <div class="loading-dot"></div>
                </div>
              </div>
            </div>
          `;
          
          // Redirect to admin panel after successful login
          setTimeout(() => {
            window.location.href = '/admin.html';
          }, 2000);
        } else {
          // Show error state
          loading.className = 'loading loading-error';
          loading.innerHTML = `
            <div class="loading-content">
              <div class="loading-spinner"></div>
              <div>
                <p class="loading-text">‚ùå ƒêƒÉng nh·∫≠p th·∫•t b·∫°i</p>
                <p class="loading-subtext">${result.message || 'Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin'}</p>
                <div class="loading-dots">
                  <div class="loading-dot"></div>
                  <div class="loading-dot"></div>
                  <div class="loading-dot"></div>
                </div>
              </div>
            </div>
          `;
          
          // Show form again after 3 seconds
          setTimeout(() => {
            loading.style.display = 'none';
            loading.className = 'loading';
            form.style.display = 'block';
            loginBtn.disabled = false;
          }, 3000);
        }
      } catch (error) {
        console.error('Login error:', error);
        
        // Show error state
        loading.className = 'loading loading-error';
        loading.innerHTML = `
          <div class="loading-content">
            <div class="loading-spinner"></div>
            <div>
              <p class="loading-text">‚ùå L·ªói k·∫øt n·ªëi</p>
              <p class="loading-subtext">Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi v√† th·ª≠ l·∫°i</p>
              <div class="loading-dots">
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
              </div>
            </div>
          </div>
        `;
        
        // Show form again after 3 seconds
        setTimeout(() => {
          loading.style.display = 'none';
          loading.className = 'loading';
          form.style.display = 'block';
          loginBtn.disabled = false;
        }, 3000);
      }
    }

    let allSessions = [];
    let activeSessions = [];
    let historySessions = [];
    let currentHistoryFilter = 'all';
    let allUserPayments = [];
    let currentUserFilter = 'all';

    // Load initial data
    loadAllData();
    

    async function loadAllData() {
      await Promise.all([
        loadOverviewStats(),
        loadSessions(),
        loadTopParticipants(),
        loadMasterStatistics(),
        loadUserPayments()
      ]);
    }

    async function loadOverviewStats() {
      try {
        const response = await fetch('/api/v1/public/statistics/overview');
        const result = await response.json();

        if (!result.success) {
          throw new Error('Failed to load overview stats');
        }

        const { sessions, payments, users } = result.data;

        const statsHTML = `
          <div class="stat-card">
            <h3>üìä T·ªïng Sessions</h3>
            <div class="value">${sessions.total}</div>
            <div class="label">${sessions.completed} ho√†n th√†nh, ${sessions.pending} ƒëang ch·ªù</div>
          </div>

          <div class="stat-card">
            <h3>üí∞ Thu Nh·∫≠p</h3>
            <div class="value">${formatCurrency(payments.totalRevenue)}</div>
            <div class="label">T·ª∑ l·ªá thu: ${payments.collectionRate}%</div>
          </div>

          <div class="stat-card">
            <h3>‚è≥ C√≤n N·ª£</h3>
            <div class="value">${formatCurrency(payments.totalOutstanding)}</div>
            <div class="label">${payments.unpaid} payments ch∆∞a tr·∫£</div>
          </div>

          <div class="stat-card">
            <h3>üë• Th√†nh Vi√™n</h3>
            <div class="value">${users.total}</div>
            <div class="label">üë¶ ${users.male} nam, üëß ${users.female} n·ªØ</div>
          </div>
        `;

        document.getElementById('overview-stats').innerHTML = statsHTML;
      } catch (error) {
        console.error('Error loading overview stats:', error);
        document.getElementById('overview-stats').innerHTML = 
          '<div class="error">‚ùå Kh√¥ng th·ªÉ t·∫£i th·ªëng k√™ t·ªïng quan</div>';
      }
    }

    async function loadSessions() {
      try {
        const response = await fetch('/api/v1/public/sessions?limit=50');
        const result = await response.json();

        if (!result.success) {
          throw new Error('Failed to load sessions');
        }

        allSessions = result.data;
        
        // T√°ch th√†nh active v√† history
        activeSessions = allSessions.filter(s => s.status === 'pending');
        historySessions = allSessions.filter(s => s.status === 'completed');
        
        renderActiveSessions();
        renderHistorySessions();
      } catch (error) {
        console.error('Error loading sessions:', error);
        document.getElementById('active-sessions-list').innerHTML = 
          '<div class="error">‚ùå Kh√¥ng th·ªÉ t·∫£i sessions</div>';
        document.getElementById('history-sessions-list').innerHTML = 
          '<div class="error">‚ùå Kh√¥ng th·ªÉ t·∫£i l·ªãch s·ª≠</div>';
      }
    }

    function renderActiveSessions() {
      if (activeSessions.length === 0) {
        document.getElementById('active-sessions-list').innerHTML = 
          '<div style="text-align: center; padding: 40px; color: #666;">üì≠ Kh√¥ng c√≥ sessions ƒëang ho·∫°t ƒë·ªông</div>';
        return;
      }

      const sessionsHTML = activeSessions.map(session => `
        <div class="session-card ${session.status}" onclick="window.location.href='/session.html?id=${session.id}'">
          <div class="session-header">
            <div class="session-date">
              üìÖ ${formatDate(session.playDate)}
            </div>
            <div class="session-status ${session.status}">
              ${session.status === 'completed' ? '‚úÖ Ho√†n th√†nh' : '‚è≥ ƒêang ch·ªù'}
            </div>
          </div>

          <div class="session-stats">
            <div class="session-stat">
              <div class="session-stat-value">${session._count.votes}</div>
              <div class="session-stat-label">üë• Votes</div>
            </div>
            <div class="session-stat">
              <div class="session-stat-value">${session.courtCount}</div>
              <div class="session-stat-label">üèüÔ∏è S√¢n</div>
            </div>
            <div class="session-stat">
              <div class="session-stat-value">${session.shuttleCount}</div>
              <div class="session-stat-label">üè∏ C·∫ßu</div>
            </div>
            <div class="session-stat">
              <div class="session-stat-value">${formatCurrency(session.totalCost)}</div>
              <div class="session-stat-label">üí∞ Chi ph√≠</div>
            </div>
            ${session._count.payments > 0 ? `
              <div class="session-stat">
                <div class="session-stat-value">${session._count.payments}</div>
                <div class="session-stat-label">üí≥ Payments</div>
              </div>
            ` : ''}
          </div>
        </div>
      `).join('');

      document.getElementById('active-sessions-list').innerHTML = sessionsHTML;
    }

    function renderHistorySessions() {
      const filtered = currentHistoryFilter === 'recent' 
        ? historySessions.slice(0, 10) 
        : historySessions;

      if (filtered.length === 0) {
        document.getElementById('history-sessions-list').innerHTML = 
          '<div style="text-align: center; padding: 40px; color: #666;">üì≠ Ch∆∞a c√≥ l·ªãch s·ª≠ sessions</div>';
        return;
      }

      const sessionsHTML = filtered.map(session => `
        <div class="session-card ${session.status}" onclick="window.location.href='/session.html?id=${session.id}'">
          <div class="session-header">
            <div class="session-date">
              üìÖ ${formatDate(session.playDate)}
            </div>
            <div class="session-status ${session.status}">
              ‚úÖ Ho√†n th√†nh
            </div>
          </div>

          <div class="session-stats">
            <div class="session-stat">
              <div class="session-stat-value">${session._count?.votes || 0}</div>
              <div class="session-stat-label">üë• Votes</div>
            </div>
            <div class="session-stat">
              <div class="session-stat-value">${session._count?.proxyVotes || 0}</div>
              <div class="session-stat-label">ü§ù Vote h·ªô</div>
            </div>
            <div class="session-stat">
              <div class="session-stat-value">${formatCurrency(session.totalCost || 0)}</div>
              <div class="session-stat-label">üí∞ T·ªïng</div>
            </div>
            ${session.stats ? `
              <div class="session-stat">
                <div class="session-stat-value">${session.stats.paymentCompletionRate || 0}%</div>
                <div class="session-stat-label">üí≥ ƒê√£ thu</div>
              </div>
            ` : ''}
          </div>
        </div>
      `).join('');

      document.getElementById('history-sessions-list').innerHTML = sessionsHTML;
    }

    function filterHistory(type) {
      currentHistoryFilter = type;
      
      // Update button states
      const buttons = document.querySelectorAll('#history-sessions-list').parentElement.querySelectorAll('.filter-btn');
      buttons.forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      renderHistorySessions();
    }

    async function loadTopParticipants() {
      try {
        const response = await fetch('/api/v1/public/statistics/overview');
        const result = await response.json();

        if (!result.success || !result.data.topParticipants) {
          throw new Error('Failed to load top participants');
        }

        const participants = result.data.topParticipants;

        if (participants.length === 0) {
          document.getElementById('top-participants-list').innerHTML = 
            '<div style="text-align: center; padding: 40px; color: #666;">üì≠ Ch∆∞a c√≥ d·ªØ li·ªáu</div>';
          return;
        }

        const participantsHTML = participants.map((p, index) => `
          <div class="participant-item">
            <div class="participant-rank">${index + 1}</div>
            <div class="participant-name">
              ${p.user.gender === 'male' ? 'üë¶' : 'üëß'} ${p.user.name}
            </div>
            <div class="participant-count">${p.participationCount} l·∫ßn</div>
          </div>
        `).join('');

        document.getElementById('top-participants-list').innerHTML = participantsHTML;
      } catch (error) {
        console.error('Error loading top participants:', error);
        document.getElementById('top-participants-list').innerHTML = 
          '<div class="error">‚ùå Kh√¥ng th·ªÉ t·∫£i top participants</div>';
      }
    }

    async function loadMasterStatistics() {
      try {
        const response = await fetch('/api/v1/public/statistics/overview');
        const result = await response.json();

        if (!result.success) {
          document.getElementById('master-stats-grid').innerHTML = 
            '<div class="error">‚ùå Kh√¥ng th·ªÉ t·∫£i th·ªëng k√™</div>';
          return;
        }

        const stats = result.data;
        renderMasterStatistics(stats);
      } catch (error) {
        console.error('Error loading master statistics:', error);
        document.getElementById('master-stats-grid').innerHTML = 
          '<div class="error">‚ùå L·ªói t·∫£i th·ªëng k√™</div>';
      }
    }

    function renderMasterStatistics(stats) {
      const grid = document.getElementById('master-stats-grid');
      
      // Calculate derived stats
      const totalRevenue = stats.payments?.totalRevenue || 0;
      const paymentCompletionRate = parseFloat(stats.payments?.collectionRate || 0);
      const averageSessionSize = stats.sessions?.total > 0 ? 
        Math.round((stats.users?.total || 0) / stats.sessions?.total) : 0;
      
      const cards = [
        {
          icon: 'üè∏',
          value: stats.sessions?.total || 0,
          label: 'T·ªïng Sessions',
          trend: stats.sessions?.completed > 0 ? `+${Math.round((stats.sessions.completed / stats.sessions.total) * 100)}%` : '0%'
        },
        {
          icon: 'üë•',
          value: stats.users?.total || 0,
          label: 'T·ªïng Ng∆∞·ªùi Ch∆°i',
          trend: stats.users?.male > 0 ? `Nam: ${stats.users.male}` : '0'
        },
        {
          icon: 'üí∞',
          value: totalRevenue.toLocaleString('vi-VN') + 'ƒë',
          label: 'T·ªïng Doanh Thu',
          trend: stats.payments?.paid > 0 ? `ƒê√£ thu: ${(totalRevenue - (stats.payments?.totalOutstanding || 0)).toLocaleString('vi-VN')}ƒë` : '0ƒë'
        },
        {
          icon: 'üèÜ',
          value: averageSessionSize,
          label: 'Trung B√¨nh/Session',
          trend: stats.sessions?.recent > 0 ? `G·∫ßn ƒë√¢y: ${stats.sessions.recent}` : '0'
        },
        {
          icon: 'üìÖ',
          value: stats.sessions?.completed || 0,
          label: 'Sessions Ho√†n Th√†nh',
          trend: stats.sessions?.pending > 0 ? `ƒêang ch·ªù: ${stats.sessions.pending}` : '0'
        },
        {
          icon: 'üí≥',
          value: paymentCompletionRate + '%',
          label: 'T·ª∑ L·ªá Thanh To√°n',
          trend: stats.payments?.unpaid > 0 ? `C√≤n n·ª£: ${(stats.payments.totalOutstanding).toLocaleString('vi-VN')}ƒë` : '0ƒë'
        }
      ];

      grid.innerHTML = cards.map(card => `
        <div class="master-stat-card" onclick="openMasterStatistics()">
          <div class="master-stat-icon">${card.icon}</div>
          <div class="master-stat-value">${card.value}</div>
          <div class="master-stat-label">${card.label}</div>
          <div class="master-stat-trend trend-up">${card.trend}</div>
        </div>
      `).join('');
    }

    function openMasterStatistics() {
      // Create master statistics modal
      const modal = document.createElement('div');
      modal.className = 'master-stats-modal';
      modal.innerHTML = `
        <div class="master-stats-modal-content">
          <div class="master-stats-modal-header">
            <h2>üìä Th·ªëng K√™ T·ªïng Quan Chi Ti·∫øt</h2>
            <span class="master-stats-close" onclick="closeMasterStatistics()">&times;</span>
          </div>
          <div class="master-stats-modal-body">
            <div class="loading">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu chi ti·∫øt...</div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      modal.style.display = 'block';
      
      
      // Load detailed statistics
      loadDetailedMasterStatistics();
    }

    function closeMasterStatistics() {
      const modal = document.querySelector('.master-stats-modal');
      if (modal) {
        modal.remove();
      }
    }

    async function loadDetailedMasterStatistics() {
      try {
        const response = await fetch('/api/v1/public/statistics/overview');
        const result = await response.json();

        if (!result.success) {
          document.querySelector('.master-stats-modal-body').innerHTML = 
            '<div class="error">‚ùå Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu chi ti·∫øt</div>';
          return;
        }

        const stats = result.data;
        renderDetailedMasterStatistics(stats);
      } catch (error) {
        console.error('Error loading detailed master statistics:', error);
        document.querySelector('.master-stats-modal-body').innerHTML = 
          '<div class="error">‚ùå L·ªói t·∫£i d·ªØ li·ªáu chi ti·∫øt</div>';
      }
    }

    function renderDetailedMasterStatistics(stats) {
      const body = document.querySelector('.master-stats-modal-body');
      
      // Calculate derived stats
      const totalRevenue = stats.payments?.totalRevenue || 0;
      const paymentCompletionRate = parseFloat(stats.payments?.collectionRate || 0);
      const averageSessionSize = stats.sessions?.total > 0 ? 
        Math.round((stats.users?.total || 0) / stats.sessions?.total) : 0;
      const paidAmount = totalRevenue - (stats.payments?.totalOutstanding || 0);
      
      body.innerHTML = `
        <div class="detailed-stats-grid">
          <div class="detailed-stat-section">
            <h3>üìà T·ªïng Quan</h3>
            <div class="detailed-stat-item">
              <span class="stat-label">T·ªïng Sessions:</span>
              <span class="stat-value">${stats.sessions?.total || 0}</span>
            </div>
            <div class="detailed-stat-item">
              <span class="stat-label">Sessions Ho√†n Th√†nh:</span>
              <span class="stat-value">${stats.sessions?.completed || 0}</span>
            </div>
            <div class="detailed-stat-item">
              <span class="stat-label">Sessions ƒêang Ch·ªù:</span>
              <span class="stat-value">${stats.sessions?.pending || 0}</span>
            </div>
            <div class="detailed-stat-item">
              <span class="stat-label">T·ªïng Ng∆∞·ªùi Ch∆°i:</span>
              <span class="stat-value">${stats.users?.total || 0}</span>
            </div>
            <div class="detailed-stat-item">
              <span class="stat-label">Nam:</span>
              <span class="stat-value">${stats.users?.male || 0}</span>
            </div>
            <div class="detailed-stat-item">
              <span class="stat-label">N·ªØ:</span>
              <span class="stat-value">${stats.users?.female || 0}</span>
            </div>
            <div class="detailed-stat-item">
              <span class="stat-label">Trung B√¨nh/Session:</span>
              <span class="stat-value">${averageSessionSize} ng∆∞·ªùi</span>
            </div>
          </div>
          
          <div class="detailed-stat-section">
            <h3>üí∞ Doanh Thu</h3>
            <div class="detailed-stat-item">
              <span class="stat-label">T·ªïng Doanh Thu:</span>
              <span class="stat-value">${totalRevenue.toLocaleString('vi-VN')}ƒë</span>
            </div>
            <div class="detailed-stat-item">
              <span class="stat-label">ƒê√£ Thu:</span>
              <span class="stat-value">${paidAmount.toLocaleString('vi-VN')}ƒë</span>
            </div>
            <div class="detailed-stat-item">
              <span class="stat-label">C√≤n Thi·∫øu:</span>
              <span class="stat-value">${(stats.payments?.totalOutstanding || 0).toLocaleString('vi-VN')}ƒë</span>
            </div>
            <div class="detailed-stat-item">
              <span class="stat-label">T·ª∑ L·ªá Thu:</span>
              <span class="stat-value">${paymentCompletionRate}%</span>
            </div>
          </div>
          
          <div class="detailed-stat-section">
            <h3>üí≥ Thanh To√°n</h3>
            <div class="detailed-stat-item">
              <span class="stat-label">T·ªïng Giao D·ªãch:</span>
              <span class="stat-value">${stats.payments?.total || 0}</span>
            </div>
            <div class="detailed-stat-item">
              <span class="stat-label">ƒê√£ Tr·∫£:</span>
              <span class="stat-value">${stats.payments?.paid || 0}</span>
            </div>
            <div class="detailed-stat-item">
              <span class="stat-label">Ch∆∞a Tr·∫£:</span>
              <span class="stat-value">${stats.payments?.unpaid || 0}</span>
            </div>
            <div class="detailed-stat-item">
              <span class="stat-label">T·ª∑ L·ªá Ho√†n Th√†nh:</span>
              <span class="stat-value">${paymentCompletionRate}%</span>
            </div>
          </div>
        </div>
      `;
    }

    async function loadUserPayments() {
      try {
        const response = await fetch('/api/v1/public/payments/user-payments?limit=100');
        const result = await response.json();

        if (!result.success) {
          throw new Error('Failed to load user payments');
        }

        allUserPayments = result.data;
        renderUserPayments();
      } catch (error) {
        console.error('Error loading user payments:', error);
        document.getElementById('user-payments-list').innerHTML = 
          '<div class="error">‚ùå Kh√¥ng th·ªÉ t·∫£i th·ªëng k√™ thanh to√°n</div>';
      }
    }

    function renderUserPayments() {
      const filteredPayments = currentUserFilter === 'all' 
        ? allUserPayments 
        : allUserPayments.filter(user => {
            if (currentUserFilter === 'paid') return user.paidCount > 0;
            if (currentUserFilter === 'unpaid') return user.unpaidCount > 0;
            return true;
          });

      if (filteredPayments.length === 0) {
        document.getElementById('user-payments-list').innerHTML = 
          '<div class="no-payments">üì≠ Ch∆∞a c√≥ d·ªØ li·ªáu thanh to√°n</div>';
        return;
      }

      const paymentsHTML = filteredPayments.map(user => {
        const genderIcon = user.userName.includes('Nam') ? 'üë¶' : 'üëß';
        const initials = user.userName.split(' ').map(n => n[0]).join('').toUpperCase();
        
        return `
          <div class="user-payment-card">
            <div class="user-payment-header">
              <div class="user-info">
                <div class="user-avatar">${initials}</div>
                <div class="user-details">
                  <h3>${genderIcon} ${user.userName}</h3>
                  <p>${user.payments.length} l·∫ßn thanh to√°n</p>
                </div>
              </div>
              <div class="payment-summary">
                <div class="total-amount">${formatCurrency(user.totalAmount)}</div>
                <div class="payment-count">
                  ‚úÖ ${user.paidCount} ƒë√£ tr·∫£ | ‚ùå ${user.unpaidCount} ch∆∞a tr·∫£
                </div>
              </div>
            </div>
            
            <div class="payment-timeline">
              <div class="timeline-header">
                <h4>üìÖ L·ªãch s·ª≠ thanh to√°n</h4>
                <button class="timeline-toggle" onclick="toggleTimeline('${user.userId}')">
                  Xem chi ti·∫øt
                </button>
              </div>
              <div class="timeline-content" id="timeline-${user.userId}">
                ${user.payments.map(payment => `
                  <div class="timeline-item">
                    <div class="timeline-date">${formatDate(payment.sessionDate)}</div>
                    <div class="timeline-amount">${formatCurrency(payment.amount)}</div>
                    <div class="timeline-status ${payment.paid ? 'paid' : 'unpaid'}">
                      ${payment.paid ? 'ƒê√£ tr·∫£' : 'Ch∆∞a tr·∫£'}
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        `;
      }).join('');

      document.getElementById('user-payments-list').innerHTML = paymentsHTML;
    }

    function filterUserPayments(status) {
      currentUserFilter = status;
      
      // Update button states
      document.querySelectorAll('.user-payments-container .filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      renderUserPayments();
    }

    function toggleTimeline(userId) {
      const timeline = document.getElementById(`timeline-${userId}`);
      const button = event.target;
      
      if (timeline.classList.contains('show')) {
        timeline.classList.remove('show');
        button.textContent = 'Xem chi ti·∫øt';
      } else {
        timeline.classList.add('show');
        button.textContent = '·∫®n chi ti·∫øt';
      }
    }


    // Modal functions removed - using separate page instead

    function formatDate(dateString) {
      const date = new Date(dateString);
      const day = date.getDate().toString().padStart(2, '0');
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const year = date.getFullYear();
      return `${day}/${month}/${year}`;
    }

    function formatCurrency(amount) {
      if (!amount) return '0ƒë';
      return amount.toLocaleString('vi-VN') + 'ƒë';
    }

    // Auto refresh every 30 seconds
    setInterval(loadAllData, 30000);
  </script>
</body>
</html>

